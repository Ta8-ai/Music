<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Music Player</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: sans-serif;
            background-color: #222;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
        }
        .player-container {
            background-color: #333;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
            width: 90%;
            max-width: 400px;
            text-align: center;
        }
        h1 {
            margin-bottom: 20px;
            color: #1db954;
        }
        .song-info {
            margin-bottom: 20px;
        }
        #now-playing-title {
            font-size: 1.2em;
            font-weight: bold;
        }
        #now-playing-artist {
            font-size: 0.9em;
            color: #bbb;
        }
        .controls button {
            background-color: #1db954;
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 1.5em;
            margin: 0 10px;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.2s;
        }
        .controls button:hover {
            background-color: #1ed760;
            transform: scale(1.05);
        }
        .controls button:active {
            transform: scale(0.95);
        }
        .controls button.small {
            width: 40px;
            height: 40px;
            font-size: 1.2em;
            background-color: #555;
        }
        .controls button.small:hover {
            background-color: #777;
        }
        .song-list {
            list-style: none;
            padding: 0;
            margin-top: 20px;
            max-height: 200px;
            overflow-y: auto;
            border-top: 1px solid #444;
            padding-top: 10px;
        }
        .song-list li {
            padding: 8px 0;
            cursor: pointer;
            transition: background-color 0.2s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .song-list li:hover {
            background-color: #444;
        }
        .song-list li.active {
            color: #1db954;
            font-weight: bold;
        }
        .song-list .play-icon {
            font-size: 0.8em;
            margin-left: 10px;
            color: #888;
            visibility: hidden; /* Hidden by default */
        }
        .song-list li:hover .play-icon,
        .song-list li.active .play-icon {
            visibility: visible; /* Visible on hover or when active */
        }
    </style>
</head>
<body>
    <div class="player-container">
        <h1>My Simple Music Player</h1>
        
        <div class="song-info">
            <div id="now-playing-title">No song selected</div>
            <div id="now-playing-artist">-</div>
        </div>

        <div class="controls">
            <button id="prev-btn" class="small"><i class="fas fa-step-backward"></i></button>
            <button id="play-pause-btn"><i class="fas fa-play"></i></button>
            <button id="next-btn" class="small"><i class="fas fa-step-forward"></i></button>
        </div>

        <ul class="song-list" id="song-list">
            <!-- Songs will be populated here -->
        </ul>

        <audio id="audio-element"></audio>
    </div>

    <script>
        // Define an empty array to hold song data, which will be loaded from JSON
        let songs = []; 

        // DOM elements
        const audio = document.getElementById('audio-element');
        const playPauseBtn = document.getElementById('play-pause-btn');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const nowPlayingTitle = document.getElementById('now-playing-title');
        const nowPlayingArtist = document.getElementById('now-playing-artist');
        const songListElement = document.getElementById('song-list');

        // State
        let isPlaying = false;
        let currentSongIndex = 0;

        // Function to format time (still useful for debugging/future expansion)
        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            let secs = Math.floor(seconds % 60);
            if (secs < 10) {
                secs = `0${secs}`;
            }
            return `${minutes}:${secs}`;
        }

        // Render songs list
        function renderSongsList() {
            songListElement.innerHTML = ''; // Clear existing list
            if (songs.length === 0) {
                songListElement.innerHTML = '<li>No songs loaded. Check console for errors.</li>';
                return;
            }
            songs.forEach((song, index) => {
                const listItem = document.createElement('li');
                listItem.textContent = `${index + 1}. ${song.title} - ${song.artist}`;
                listItem.setAttribute('data-index', index); // Store index for easy access
                
                // Add a play icon that appears on hover/active
                const playIcon = document.createElement('i');
                playIcon.classList.add('fas', 'fa-play', 'play-icon');
                listItem.appendChild(playIcon);

                listItem.addEventListener('click', () => {
                    if (currentSongIndex === index && isPlaying) {
                        pauseSong();
                    } else {
                        currentSongIndex = index;
                        loadSong(currentSongIndex);
                        playSong();
                    }
                });
                songListElement.appendChild(listItem);
            });
            updateActiveSongInList(); // Call initially to highlight first song
        }

        // Load song into the audio element and update display
        function loadSong(index) {
            if (songs.length === 0) {
                nowPlayingTitle.textContent = "No songs available";
                nowPlayingArtist.textContent = "";
                return;
            }
            const song = songs[index];
            audio.src = song.mp3;
            nowPlayingTitle.textContent = song.title;
            nowPlayingArtist.textContent = song.artist;
            updateActiveSongInList(); // Update highlight and row icon
        }

        // Update active song highlight in the list
        function updateActiveSongInList() {
            const listItems = songListElement.querySelectorAll('li');
            listItems.forEach((item, index) => {
                item.classList.remove('active');
                const icon = item.querySelector('.play-icon');
                if (icon) {
                    icon.classList.remove('fa-pause');
                    icon.classList.add('fa-play');
                }
            });

            if (listItems[currentSongIndex]) {
                listItems[currentSongIndex].classList.add('active');
                const icon = listItems[currentSongIndex].querySelector('.play-icon');
                if (icon) {
                    if (isPlaying) {
                        icon.classList.remove('fa-play');
                        icon.classList.add('fa-pause');
                    } else {
                        icon.classList.remove('fa-pause');
                        icon.classList.add('fa-play');
                    }
                }
            }
        }

        // Play song
        function playSong() {
            isPlaying = true;
            playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
            audio.play().catch(error => {
                console.error("Error playing audio:", error);
                if (error.name === "NotAllowedError" || error.name === "AbortError") {
                    console.warn("Autoplay was prevented. User must interact with the page first.");
                    nowPlayingTitle.textContent = "Click play to start!";
                    nowPlayingArtist.textContent = "Browser blocked autoplay";
                } else if (error.name === "NetworkError") {
                    console.error("Network error: Audio file might not exist or path is wrong.");
                    nowPlayingTitle.textContent = "Error loading song!";
                    nowPlayingArtist.textContent = "Check file path in console.";
                }
                isPlaying = false; // Reset state if play fails
                playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
            });
            updateActiveSongInList();
        }

        // Pause song
        function pauseSong() {
            isPlaying = false;
            playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
            audio.pause();
            updateActiveSongInList();
        }

        // Toggle play/pause
        function togglePlay() {
            if (isPlaying) {
                pauseSong();
            } else {
                playSong();
            }
        }

        // Previous song
        function prevSong() {
            currentSongIndex--;
            if (currentSongIndex < 0) {
                currentSongIndex = songs.length - 1; // Loop to end
            }
            loadSong(currentSongIndex);
            playSong();
        }

        // Next song
        function nextSong() {
            currentSongIndex++;
            if (currentSongIndex >= songs.length) {
                currentSongIndex = 0; // Loop to beginning
            }
            loadSong(currentSongIndex);
            playSong();
        }

        // Handle song ending
        audio.addEventListener('ended', nextSong);

        // Event listeners for main controls
        playPauseBtn.addEventListener('click', togglePlay);
        prevBtn.addEventListener('click', prevSong);
        nextBtn.addEventListener('click', nextSong);

        // --- NEW: Function to fetch song data from JSON ---
        async function fetchSongsData() {
            try {
                // Assuming your JSON file is named 'songs.json' and is in the same directory as index.html
                // If it's in a different location, adjust the path here (e.g., 'data/songs.json')
                const response = await fetch('songs.json'); 
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                songs = data; // Assign fetched data to the songs array
                console.log("Songs loaded from JSON:", songs); // For debugging
            } catch (error) {
                console.error("Could not fetch songs data:", error);
                nowPlayingTitle.textContent = "Error loading songs!";
                nowPlayingArtist.textContent = "Check console for JSON file errors.";
            }
        }

        // Initial setup - now waits for songs to load from JSON
        document.addEventListener('DOMContentLoaded', async () => {
            await fetchSongsData(); // Wait for songs to be loaded
            if (songs.length > 0) {
                renderSongsList();
                loadSong(currentSongIndex); // Load the first song, but don't autoplay
            } else {
                // Handle case where no songs are loaded (e.g., JSON file empty or error)
                songListElement.innerHTML = '<li>Failed to load songs.</li>';
            }
        });
    </script>
</body>
</html>
